dependencies:
  pre:
    - yes | sudo apt-get update; sudo apt-get install zip
    - yes | pecl install mongodb
    - echo "extension=mongodb.so" > /opt/circleci/php/$(phpenv global)/etc/php.ini
  cache_directories:
      - ./vendor
test:
  override:
    - phpunit

deployment:
  prod:
    branch: master
    commands:
      - export CURRENT_DEPLOYMENT=pggdeploy-$(date '+%Y-%m-%d_%H-%M-%S')
      - zip -r ${CURRENT_DEPLOYMENT}.zip .
      - aws s3 sync ${CURRENT_DEPLOYMENT}.zip s3://paragongg-deployment/app/ --delete